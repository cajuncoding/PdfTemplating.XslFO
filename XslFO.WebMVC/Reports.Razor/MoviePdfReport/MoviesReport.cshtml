@model XslFO.WebMVC.MovieSearch.MovieSearchResponse
@{
    Layout = "~/Reports.Razor/_PdfReportLayout.cshtml";
}

@functions {
    string dateTimeStamp = DateTime.Now.ToString(DateFormat.Extended);
}

@* OUTPUT PAGE SEQUENCE
    NOTE: Use different Page Sequence Blocks if you need to Change Layout/Orientation of Pages
*@
<fo:page-sequence master-reference="report-master">

    @* RENDER STATIC FOOTER REGION AS STATIC CONTENT; APPEARS ON EVERY PAGE*@
    @* NOTE:  FOOTER AND HEADERS MUST BE DEFINED BEFORE THE BODY FOR VALID XslFO PROCESSING *@
    @Html.Partial("~/Reports.Razor/_MovieFooterPartial.cshtml", $"Movie Search for [{Model.SearchTitle}] on [{dateTimeStamp}]")

    @* Render Content Flow element targeted to the 'xsl-region-body'*@
    <fo:flow flow-name="xsl-region-body" font-size="@FontSize.Default" font-family="@FontFamily.Default">

        @* Root Block Element *@
        <fo:block font-size="@FontSize.Medium">

            @* Render the Cover Page from the root Node Match *@
            @RenderCoverPage(Model.SearchTitle)

            @* Render each Result
                NOTE: We Sort the order by Year Ascending and then apply the template to each item!
            *@
            @foreach (var movie in Model.SearchResults.OrderBy(m => m.Year))
            {
                @RenderMoviePage(movie)
            }

            @*OUTPUT REFERENCES FOR LAST PAGE - MUST APPEAR AFTER ALL CONTENT HAS BEEN RENDERED via TEMPLATES *@
            <fo:marker marker-class-name="Marker.LastPageFooterContent" />
            <fo:block id="ref-last-page" />

        </fo:block>
    </fo:flow>

</fo:page-sequence>


@helper RenderCoverPage(String title)
{
    <fo:block break-before="auto">
        <fo:block text-align="center">

            @* Generate a Horizontal Rule *@
            <fo:block font-size="@FontSize.H1" space-before="2.5in" border-bottom="@Border.HorizontalRule"></fo:block>

            <fo:block font-size="@FontSize.H1" space-before=".5in">
                Movie Search for "@title"
            </fo:block>
            <fo:block font-size="@FontSize.H1" space-before=".5in">
                Executed on: @dateTimeStamp
            </fo:block>

            @* Generate a Horizontal Rule *@
            <fo:block space-before=".5in" border-bottom="@Border.HorizontalRule"></fo:block>

        </fo:block>
    </fo:block>
}


@helper RenderMoviePage(XslFO.WebMVC.MovieSearch.SearchResult movie)
{
    @* Render Each Search Results with this template...
        NOTE: Each of the Search rendered items will be on it's own Page by including Page Breaks
    *@
    <fo:block break-before="page">

        @* Output Heading info *@
        <fo:block text-align="center">
            <fo:block font-size="@FontSize.H1" border-bottom="@Border.HorizontalRule">
                @movie.Title
            </fo:block>
        </fo:block>

        <fo:block font-size="@FontSize.H3">
            <fo:table width="100%">
                <fo:table-column column-width="proportional-column-width(1)" />
                <fo:table-column column-width="proportional-column-width(.75)" />
                <fo:table-body>
                    <fo:table-row>
                        <fo:table-cell padding="10px">

                            @* Render Image *@
                            <fo:external-graphic src="url('@movie.Poster')" width="300px" scaling="uniform" />

                        </fo:table-cell>
                        <fo:table-cell padding="10px">

                            @* Render Fields/Info *@
                            <fo:block space-before="@Paragraph.SpaceBefore">
                                Title: @movie.Title
                            </fo:block>
                            <fo:block space-before="@Paragraph.SpaceBefore">
                                Year: @movie.Year
                            </fo:block>
                            <fo:block space-before="@Paragraph.SpaceBefore">
                                IMDB ID: @movie.ImdbID
                            </fo:block>

                        </fo:table-cell>
                    </fo:table-row>
                </fo:table-body>
            </fo:table>
        </fo:block>

    </fo:block>
}
